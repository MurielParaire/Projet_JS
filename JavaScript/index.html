<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Accueil</title>

    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

</head>
<body>

<nav>
    <ul>
        <li> Accueil </li>
        <li> <a href = "documentation.html"> Documentation </a></li>
    </ul>
</nav>

<h1>Données des capteurs</h1>
<p id="status">Pas connecté</p>
<p> Affichage de la température : <span id="datas"> </span></p>


<script>
    var socket = new WebSocket("wss://ws.hothothot.dog:9502");
    socket.onopen = function(event) {
        console.log("Connexion établie");

        //On indique sur notre page web que la connexion est établie
        let label = document.getElementById("status");
        label.innerHTML = "Connexion établie";

        var intervaltemp = setInterval (function() {
            //Envoi d'un message au serveur (obligatoire)
            socket.send("coucou !");

            // au retour...
            socket.onmessage = function(event) {
                var datas = document.getElementById("datas");
                datas.innerHTML = event.data;
            }
        }, 5000)

    }
    socket.onerror = function(event) {
        fetch('https://hothothot.dog/api/capteurs').then(function (response) {
            return response.json();
        }).then(function (data) {
            console.log(data);

            //On indique sur notre page web que la connexion est établie
            let label = document.getElementById("status");
            label.innerHTML = "Connexion établie";

            var eventData = data;

            var intervaltemp = setInterval (function() {
                console.log(eventData.HotHotHot);

                console.log(eventData.capteurs[0].type);
                console.log(eventData.capteurs[0].Nom);
                console.log(eventData.capteurs[0].Valeur);
                console.log(eventData.capteurs[0].Timestamp);

                console.log(eventData.capteurs[1].type);
                console.log(eventData.capteurs[1].Nom);
                console.log(eventData.capteurs[1].Valeur);
                console.log(eventData.capteurs[1].Timestamp);
            },5000)
        }).catch(function (err) {
            console.warn('Something went wrong.', err);
        });
    }
</script>


</body>

</html>